<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SAKETAMU</title>
  </head>

  <body>
    <h1>UIFlow と BLE ＋ グラフ描画</h1>
    <button onclick="onStartButtonClick()">接続</button>
    <br />
    <canvas id="myChart"></canvas>

    <script> //参考：https://qiita.com/youtoy/items/3da58570972803134f6c
      const UUID_1 = "a6ad91bd-376e-465f-8c6c-460fd3e15038"; // Service
      const UUID_2 = "80d881a6-1ab3-47f0-8c75-2c31eac31f43"; // Characteristic
      const UUID_3 = "c3266f2b-8e00-485e-a75b-6a0685f9c74b"; // Descriptor

      let bluetoothDevice;
      let characteristic;

      async function onStartButtonClick() {
        try {
          console.log("Requesting Bluetooth Device...");
          const device = await navigator.bluetooth.requestDevice({
            filters: [{ namePrefix: "SAKETAMU" }],
            optionalServices: [UUID_1],
          });
          console.log("Connecting to GATT Server...");
          const server = await device.gatt.connect();
          console.log("Getting Service...");
          const service = await server.getPrimaryService(UUID_1);
          console.log("Getting Characteristic...");
          characteristic = await service.getCharacteristic(UUID_2);
          console.log("characteristic OK!!")
          alert("BLE接続が完了しました。");
        } catch (error) {
          console.log("Argh! " + error);
        }
      }
    </script>
  </body>
</html>
